using UnityEngine;
using System.Collections;
using System.Collections.Generic;

public class UI_Character_Package : UIBase {

    private Dictionary<int, UI_Character_Package_Page> mPageList = new Dictionary<int, UI_Character_Package_Page>();

    public GameObject mPagePrefab;

    public int mPageSlotMaxCount = 30;
    public int mStorageStartID;
    void Start()
    {
        InitPackage();
    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
    public UI_Package_Slot_Base GetSlotWithPos(int Pos)
    {
        if (mPageList.ContainsKey((Pos - mStorageStartID) / mPageSlotMaxCount))
            return mPageList[(Pos - mStorageStartID) / mPageSlotMaxCount].GetSlotWithPos(Pos);
        return null;
    }

    public void InitPackage()
    {
        for (int i = 0; i <= Client_User.Singleton().GetPackage().mStorageSlotCount / (mPageSlotMaxCount + 1); i++)
        {

            UI_Character_Package_Page tmpPage = (Instantiate(mPagePrefab) as GameObject).GetComponent<UI_Character_Package_Page>();
            tmpPage.transform.parent = transform;
            tmpPage.name = i + "";
            tmpPage.transform.localScale = Vector3.one;
            tmpPage.transform.localEulerAngles = Vector3.zero;
            tmpPage.InitWithStartSlotID(Client_User.Singleton().GetPackage(), i * mPageSlotMaxCount + mStorageStartID, mPageSlotMaxCount);
            mPageList.Add(i, tmpPage);
        }

        //gameObject.GetComponent<UICenterOnChild> ().CenterOn (mPageList[0].transform);
        gameObject.GetComponent<UIGrid>().Reposition();
        gameObject.GetComponent<UICenterOnChild>().Recenter();

        //foreach (int key in Game_Player_Storage_Manager.Singleton().GetItemList().Keys) 
        //{
        //    //Debug.Log (Game_Player_Storage_Manager.Singleton().GetItemList()[key]);
        //    if(key>=Game_Player_Storage_Manager.StorageStartID)
        //        InsertPackage(key,Game_Player_Storage_Manager.Singleton().GetItemList()[key]);
        //}
    }

    public void InsertPackage(int Pos, Game_Item_Base Target)
    {
        mPageList[(Pos - mStorageStartID) / mPageSlotMaxCount].InsertPageWithItem(Pos, Target);
    }
}
